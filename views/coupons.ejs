<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>予約管理システム</title>
    <link rel="stylesheet" href="/public/style.css" />
  </head>
  <body>
    <%- include("header") %>
    <div class="userAllWrapper">
      <div class="time">
        <h2>クーポン一覧画面</h2>
        <div class="time-right">
          <h4>
            <%= (() => { const d = new Date(users.updated_at); const yyyy =
            d.getFullYear(); const mm = String(d.getMonth() + 1).padStart(2,
            '0'); const dd = String(d.getDate()).padStart(2, '0'); const hh =
            String(d.getHours()).padStart(2, '0'); const mi =
            String(d.getMinutes()).padStart(2, '0'); const ss =
            String(d.getSeconds()).padStart(2, '0'); return `${yyyy}/${mm}/${dd}
            ${hh}:${mi}:${ss}`; })() %> 時点
          </h4>
        </div>
      </div>
      <div>
        <div class="couponPhoto"></div>
        <div class="couponDetails">
          <ul>
            <% let hasAvailableCoupon = false; %> <% coupons.forEach(coupon =>
            {%> <% const now = new Date(); const start = new
            Date(coupon.start_date); const end = new Date(coupon.finish_date);
            const format = (d) =>
            `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`;
            %> <% if(coupon.is_open && start <= now && now <= end){ %> <%
            hasAvailableCoupon = true; %>
            <fieldset>
              <img src="/images/<%= coupon.photo %>" alt="" />
              <li>クーポンコード: <%= coupon.code %></li>
              <li>内容: <%=coupon.name%></li>
              <li>期限: <%= format(end) %></li>
              <li>対象サービス: <%= coupon.service %></li>
            </fieldset>
            <% }}) %> <% if (!hasAvailableCoupon) { %>
            <h3>使用可能なクーポンはありません</h3>
            <% } %>
          </ul>
        </div>
      </div>
    </div>
  </body>
</html>
