<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>予約管理システム</title>
    <link rel="stylesheet" href="/public/style.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"
    />
  </head>
  <body>
    <div>
      <!-- パスワードをお忘れの方への写真 -->
      <%- include("header") %>
      <div class="allwrapper">
        <div class="time">
          <h2>管理者トップ</h2>
          <div class="time-right">
            <h4>
              <% if (users && users.updated_at) { const d = new
              Date(users.updated_at); const yyyy = d.getFullYear(); const mm =
              String(d.getMonth() + 1).padStart(2, "0"); const dd =
              String(d.getDate()).padStart(2, "0"); const hh =
              String(d.getHours()).padStart(2, "0"); const mi =
              String(d.getMinutes()).padStart(2, "0"); const ss =
              String(d.getSeconds()).padStart(2, "0"); %> <%=
              `${yyyy}/${mm}/${dd} ${hh}:${mi}:${ss}` %> 時点 <% } else { %>
              --:--:-- 時点 <% } %>
            </h4>
          </div>
        </div>
        <div class="wrapper">
          <div class="vertical">
            <div class="reserveButton">
              <a href="/adminTop?range=today" class="todaySchedules linkBox">
                <span class="fa fa-clock-o"></span>
                <span> Today's Schedules<br />本日の予約 click! </span>
              </a>
              <a href="/adminTop?range=all" class="allSchedules linkBox">
                <span class="fa fa-list"></span>
                <span> Today's Reserve List<br />全ての予約 click! </span>
              </a>
            </div>
            <div class="reserveCheck">
              <div class="reserveCheckTop">
                <h3>予約確認</h3>
                <form method="get" action="/adminTop">
                  <label>
                    <input type="checkbox" name="excludeProvided" <%= range ===
                    'today' ? 'disabled' : '' %> value="1" <%= excludeProvided ?
                    "checked" : "" %> onchange="this.form.submit()" />
                    提供済を除外
                  </label>
                </form>
              </div>
              <div class="reserveCheckContents">
                <table>
                  <thead>
                    <tr>
                      <th>氏名</th>
                      <th>予約日</th>
                      <th>開始時間</th>
                      <th>内容</th>
                      <th>ステータス</th>
                      <th>削除</th>
                      <th>編集</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% reservation.forEach(reserve => { %>
                    <tr>
                      <td><%= reserve.user_name %></td>
                      <td><%= reserve.reserve_day_str %></td>
                      <td><%= reserve.start_time %></td>
                      <td><%= reserve.resource_name %></td>
                      <td><%= reserve.status %></td>
                      <td>
                        <form
                          action="/adminTop/delete/<%= reserve.id %>"
                          method="post"
                          onsubmit="return confirm('本当に削除しますか？');"
                        >
                          <button type="submit">削除</button>
                        </form>
                      </td>
                      <td>
                        <form
                          action="/adminTop/edit/<%= reserve.id %>"
                          method="get"
                        >
                          <button type="submit">編集</button>
                        </form>
                      </td>
                    </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="information">
            <div class="newsPrint">
              <div class="newsTop">
                <h3>お知らせ</h3>
              </div>
              <div class="newsContents">
                <ul>
                  <% const today = new Date(); %> <% if (news !== undefined) {
                  %> <% news.forEach(item => { %> <% const deadline = new
                  Date(item.finish_date); const dateCheck = today <= deadline;
                  %> <% if(dateCheck){ %>
                  <li>
                    <strong><%= item.name %></strong><br />
                    <small><%= item.contents %></small>
                  </li>
                  <% }})} %>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
